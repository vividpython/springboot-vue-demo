{"version":3,"file":"js/728.0bac8ae9.js","mappings":"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","sources":["webpack://springboot-vue-demo/./src/views/Role.vue","webpack://springboot-vue-demo/./src/views/Role.vue?abc1"],"sourcesContent":["<template #default=\"scope\">\n  <div style=\"padding: 10px;\">\n\n    <!--功能区域-->\n    <div style=\"margin: 10px;padding: 0px\">\n      <el-button color=\"#E0BF75\" @click=\"add\">新增</el-button>\n      <el-button color=\"#958CDD\">导入</el-button>\n      <el-button color=\"#FFDDAB\">导出</el-button>\n      <el-button color=\"#FC9DA9\">刷新</el-button>\n    </div>\n    <!--搜索区域-->\n    <div style=\"margin: 10px ; padding: 0px\">\n      <el-form :inline=\"true\" :model=\"formInline\" class=\"demo-form-inline\" ref=\"resetformInline\">\n        <el-form-item label=\"角色名称\">\n          <el-input v-model=\"formInline.name\" placeholder=\"please input\" clearable/>\n        </el-form-item>\n        <el-form-item>\n          <el-button color=\"#E0BF75\" style=\"margin-left: 5px\" :icon=\"Search\" @click=\"load\">查询</el-button>\n          <el-button color=\"#E0BF75\" style=\"margin-left: 5px\" :icon=\"RefreshLeft\" @click=\"reset\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n\n    <!--  权限修改对话框 -->\n    <el-dialog v-model=\"permsdialogVisible\" title=\"Tips\" width=\"30%\">\n      <el-tree\n          :data=\"allPermissions\"\n          show-checkbox\n          default-expand-all\n          node-key=\"id\"\n          ref=\"tree\"\n          highlight-current\n          :props=\"defaultProps\">\n      </el-tree>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"permsdialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"setRolePermissions()\">确 定</el-button>\n      </div>\n    </el-dialog>\n\n    <!--内容区域-->\n    <el-table\n        v-loading=\"loading\"\n        :data=\"tableData\"\n        style=\"width: 100%;\"\n        border\n        class=\"table\"\n        :stripe=\"false\"\n        fit\n    >\n      <el-table-column prop=\"id\" label=\"ID\" sortable/>\n      <el-table-column prop=\"name\" label=\"角色名称\"/>\n      <el-table-column prop=\"roleKey\" label=\"角色权限字\"/>\n      <el-table-column prop=\"createTime\" label=\"创建时间\"/>\n      <el-table-column prop=\"updateTime\" label=\"更新时间\"/>\n      <el-table-column fixed=\"right\" label=\"操作\" width=\"170\">\n        <template #default=\"scope\">\n          <el-button size=\"small\" @click=\"handleEdit(scope.row)\"\n          >编辑\n          </el-button\n          >\n          <el-button size=\"small\" @click=\"handlePerms(scope.row)\"\n          >修改权限\n          </el-button\n          >\n          <el-popconfirm title=\"Are you sure to delete this?\" @confirm=\"handleDelete(scope.row.id)\">\n            <template #reference>\n              <el-button type=\"danger\" size=\"small\">删除</el-button>\n            </template>\n          </el-popconfirm>\n        </template>\n      </el-table-column>\n    </el-table>\n    <!--分页条-->\n    <div style=\"margin: 10px ; padding: 0px\">\n      <el-pagination\n          v-model:current-page=\"currentPage\"\n          v-model:page-size=\"pageSize\"\n          :page-sizes=\"[5, 10, 20, 40]\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"total\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n      />\n    </div>\n    <!--  新增对话框 -->\n    <el-dialog v-model=\"dialogVisible\" title=\"Tips\" width=\"30%\">\n      <el-form :model=\"form\" label-width=\"120px\">\n        <el-form-item label=\"角色名称\">\n          <el-input v-model=\"form.name\" style=\"width: 80%\"/>\n        </el-form-item>\n        <el-form-item label=\"角色权限关键字\">\n          <el-input v-model=\"form.roleKey\" style=\"width: 80%\"/>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"dialogVisible = false\">Cancel</el-button>\n        <el-button type=\"primary\" @click=\"save\">\n          Confirm\n        </el-button>\n      </span>\n      </template>\n    </el-dialog>\n\n\n\n  </div>\n</template>\n<script setup>\nimport {RefreshLeft, Search} from '@element-plus/icons-vue';\n</script>\n<script>\n\nimport request from \"@/utils/request\";\nimport {ElMessage} from \"element-plus\";\n\nexport default {\n  name: 'Role',\n  components: {},\n  data() {\n    return {\n      form: {},\n      loading: false,\n      formInline: {},\n      search: '',\n      currentPage: 1,\n      pageSize: 10,\n      total: 0,\n      // 新增数据的对话框显示控制\n      dialogVisible: false,\n      //权限配置对话框显示控制\n      permsdialogVisible:false,\n\n\n      allPermissions: [],\n      rolePermissions:[],\n      defaultProps: {\n        children: 'subPermissions',\n        label: 'name'\n      },\n\n\n      importData:{imporType:1},\n      headers:{\n        token: JSON.parse(sessionStorage.getItem('token'))\n      },\n\n      tableData: [],\n      RoleId:-1,\n    }\n  },\n  created() {\n    console.log(this.headers)\n    this.load()\n  },\n\n  methods: {\n    filesUploadSuccess(res){\n      this.form.img = res.data;\n    },\n    delay(time) {\n      return new Promise(resolve => setTimeout(resolve, time));\n    },\n    async load() {\n      try {\n        this.loading = true; // 显示Loading遮罩\n        //延迟执行\n        await this.delay(1000);\n        console.log(\"this.formInline:\"+this.formInline);\n        request.post(`/role/${this.currentPage}/${this.pageSize}`, JSON.parse(JSON.stringify(this.formInline))\n        ).then(res => {\n          console.log(res);\n          this.tableData = res.data.records;\n          this.total = res.data.total;\n        })\n      }catch (error){\n        console.error(error)\n      }finally {\n        this.loading = false; // 隐藏Loading遮罩\n      }\n\n    },\n    reset() {\n      this.formInline = {};\n      this.$refs[\"resetformInline\"].resetFields();\n    },\n    add() {\n      let _this = this;\n      _this.dialogVisible = true;\n      _this.form = {};\n      this.load();//更新表单数据\n      this.$nextTick(()=>{\n        this.$refs[\"upload\"].clearFiles();\n      })\n    },\n    save() {\n      //更新\n      if (this.form.id) {\n        request.put(\"/role\", this.form).then(res => {\n          console.log(res);\n          if (res.code === '0') {\n            ElMessage({\n              message: '修改成功',\n              type: 'success',\n            })\n          } else {\n            ElMessage({\n              message: '修改失败',\n              type: 'error',\n            })\n          }\n        });\n\n\n      } else {\n        //新增\n        request.post(\"/role\", this.form).then(res => {\n          console.log(res);\n          if (res.code === '0') {\n            ElMessage({\n              message: '新增成功',\n              type: 'success',\n            })\n          } else {\n            ElMessage({\n              message: '新增失败',\n              type: 'error',\n            })\n          }\n        });\n\n      }\n\n      this.dialogVisible = false;//关闭弹窗\n      this.load();//更新表单数据\n    },\n    handleEdit(row) {\n      this.form = JSON.parse(JSON.stringify(row));\n      this.dialogVisible = true;\n    },\n    //点击修改权限\n    handlePerms(row){\n      this.permsdialogVisible = true;\n      this.RoleId = row.id\n      try {\n        //获取全部权限\n        request.post(`/docperms/allPermissions`\n        ).then(res => {\n          console.log(res);\n          if (res.code === '0') {\n            this.allPermissions=res.data;\n            console.log(\"this.allPermissions:\"+this.allPermissions);\n            //查询该角色拥有的权限\n            try {\n              request.get(`/docperms/getPermissionsByRoleId/${row.id}`).then(res => {\n                if (res.code === '0') {\n                  this.rolePermissions=res.data;\n                  //设置勾选效果\n                  this.$refs.tree.setCheckedNodes(this.rolePermissions);\n                }\n              })\n            }catch (error){\n              console.error(error)\n            }\n          }\n        })\n      }catch (error){\n        console.error(error)\n      }\n    },\n\n    //设置角色权限\n    setRolePermissions(){\n      console.log(this.$refs.tree.getCheckedKeys());\n      //将数组转换成字符串\n      let keys = this.$refs.tree.getCheckedKeys();\n      let keyStr=\"\"\n      for (let i=0;i<keys.length;i++){\n        keyStr+=keys[i]+\",\";\n      }\n      keyStr.substr(0,keyStr.length-1);\n      console.log(\"keyStr:\" + keyStr)\n      request.post(`/docperms/setDocPermsByRoleId/${this.RoleId}`,{ keyStr: keyStr })\n          .then(res=>{\n            if (res.code === '0'){\n              console.log(\"权限设置成功\")\n            }\n          })\n      this.permsdialogVisible=false;\n    },\n    handleSizeChange() {\n      this.load()\n    },\n    handleCurrentChange() {\n      this.load()\n    },\n    handleDelete(id) {\n      console.log(id)\n      request.delete(\"/role/\" + id).then(res => {\n        console.log(res);\n        if (res.code === '0') {\n          ElMessage({\n            message: '删除成功',\n            type: 'success',\n          })\n        } else {\n          ElMessage({\n            message: '删除失败',\n            type: 'error',\n          })\n        }\n        this.load();\n      });\n    }\n  }\n}\n</script>\n<style>\n\n.dialog-footer {\n  margin-top: 20px;\n}\n.table tbody tr:nth-child(odd) {\n  background-color: #F5F5F5;\n}\n\n.table tbody tr:nth-child(even) {\n  background-color: #8A77A5;\n}\n\n.el-table_3_column_12 .cell {\n  background-color: #F5F5F5;\n}\n\n.el-table_3_column_12 .cell.highlight {\n  background-color: #8A77A5;\n}\n</style>\n","import script from \"./Role.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Role.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Role.vue?vue&type=style&index=0&id=20c5c1db&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["__default__","name","components","data","form","loading","formInline","search","currentPage","pageSize","total","dialogVisible","permsdialogVisible","allPermissions","rolePermissions","defaultProps","children","label","importData","imporType","headers","token","JSON","parse","sessionStorage","getItem","tableData","RoleId","created","console","log","this","load","methods","filesUploadSuccess","res","img","delay","time","Promise","resolve","setTimeout","async","request","stringify","then","records","error","reset","$refs","resetFields","add","_this","$nextTick","clearFiles","save","id","code","ElMessage","message","type","handleEdit","row","handlePerms","tree","setCheckedNodes","setRolePermissions","getCheckedKeys","keys","keyStr","i","length","substr","handleSizeChange","handleCurrentChange","handleDelete","__exports__"],"sourceRoot":""}